-- phpMyAdmin SQL Dump
-- Structure de la base de données PontConnect

SET SQL_MODE = "NO_AUTO_VALUE_ON_ZERO";
START TRANSACTION;
SET time_zone = "+00:00";

-- Suppression des tables dans l'ordre inverse des dépendances
DROP TABLE IF EXISTS RESERVATION;
DROP TABLE IF EXISTS BATEAUX;
DROP TABLE IF EXISTS USERS;
DROP TABLE IF EXISTS PONTS;
DROP TABLE IF EXISTS HORAIRES_CRENEAUX;
DROP TABLE IF EXISTS STATUS;
DROP TABLE IF EXISTS TYPE_USER;
DROP TABLE IF EXISTS PERIODE_CRENEAU;
DROP TABLE IF EXISTS DIRECTION_CRENEAU;
DROP TABLE IF EXISTS CAPTEURS;

-- Structure de la table `BATEAUX`
CREATE TABLE `BATEAUX` (
  `BATEAU_ID` int(11) NOT NULL,
  `DIRECTION_CRENEAU_ID` int(11) NOT NULL,
  `USER_ID` int(11) NOT NULL,
  `LIBELLE_BATEAU` varchar(100) DEFAULT NULL,
  `IMMATRICULATION` varchar(100) DEFAULT NULL,
  `HAUTEUR_MAX` decimal(10,2) DEFAULT NULL,
  `CREATED_AT` timestamp NULL DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

-- Structure de la table `CAPTEURS`
CREATE TABLE `CAPTEURS` (
  `CAPTEUR_ID` int(11) NOT NULL,
  `LIBELLE_CAPTEUR` varchar(50) DEFAULT NULL,
  `VALEUR_CAPTEUR` decimal(10,0) DEFAULT NULL,
  `DATE_AJOUT` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

-- Structure de la table `DIRECTION_CRENEAU`
CREATE TABLE `DIRECTION_CRENEAU` (
  `DIRECTION_CRENEAU_ID` int(11) NOT NULL,
  `LIBELLE_DIRECTION_CRENEAU` varchar(15) DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

-- Structure de la table `HORAIRES_CRENEAUX`
CREATE TABLE `HORAIRES_CRENEAUX` (
  `HORAIRES_ID` int(11) NOT NULL,
  `PERIODE_ID` int(11) NOT NULL,
  `DIRECTION_CRENEAU_ID` int(11) NOT NULL,
  `HORAIRE_DEPART` time NOT NULL,
  `HORAIRE_PASSAGE1` time DEFAULT NULL,
  `HORAIRE_PASSAGE2` time DEFAULT NULL,
  `HORAIRE_PASSAGE3` time DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

-- Structure de la table `PERIODE_CRENEAU`
CREATE TABLE `PERIODE_CRENEAU` (
  `PERIODE_ID` int(11) NOT NULL,
  `LIBELLE_PERIODE` varchar(20) DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

-- Structure de la table `PONTS`
CREATE TABLE `PONTS` (
  `PONT_ID` int(11) NOT NULL,
  `CAPTEUR_ID` int(11) NOT NULL,
  `LIBELLE_PONT` varchar(150) DEFAULT NULL,
  `ADRESSE` text
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

-- Structure de la table `RESERVATION`
CREATE TABLE `RESERVATION` (
  `USER_ID` int(11) NOT NULL,
  `PONT_ID` int(11) NOT NULL,
  `BATEAU_ID` int(11) NOT NULL,
  `STATUS_ID` int(11) NOT NULL,
  `HORAIRES_ID` int(11) NOT NULL,
  `DATE_RESERVATION` timestamp NULL DEFAULT NULL,
  `CAPACITE_MAX` int(11) DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

-- Structure de la table `STATUS`
CREATE TABLE `STATUS` (
  `STATUS_ID` int(11) NOT NULL,
  `LIBELLE_STATUS` text
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

-- Structure de la table `TYPE_USER`
CREATE TABLE `TYPE_USER` (
  `TYPE_USER_ID` int(11) NOT NULL,
  `LIBELLE_TYPE_USER` varchar(50) DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

-- Structure de la table `USERS`
CREATE TABLE `USERS` (
  `USER_ID` int(11) NOT NULL,
  `TYPE_USER_ID` int(11) NOT NULL,
  `USER_NAME` varchar(100) DEFAULT NULL,
  `EMAIL` varchar(150) DEFAULT NULL,
  `PASSWORD` text,
  `CREATED_AT` timestamp NULL DEFAULT NULL,
  `LAST_SIGN` timestamp NULL DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

-- Index pour les tables déchargées

ALTER TABLE `BATEAUX`
  ADD PRIMARY KEY (`BATEAU_ID`),
  ADD KEY `ASSOCIATION_5_FK` (`DIRECTION_CRENEAU_ID`),
  ADD KEY `BATEAUX_USER_FK` (`USER_ID`);

ALTER TABLE `CAPTEURS`
  ADD PRIMARY KEY (`CAPTEUR_ID`);

ALTER TABLE `DIRECTION_CRENEAU`
  ADD PRIMARY KEY (`DIRECTION_CRENEAU_ID`);

ALTER TABLE `HORAIRES_CRENEAUX`
  ADD PRIMARY KEY (`HORAIRES_ID`),
  ADD KEY `FK_HORAIRES_PERIODE` (`PERIODE_ID`),
  ADD KEY `FK_HORAIRES_DIRECTION` (`DIRECTION_CRENEAU_ID`);

ALTER TABLE `PERIODE_CRENEAU`
  ADD PRIMARY KEY (`PERIODE_ID`);

ALTER TABLE `PONTS`
  ADD PRIMARY KEY (`PONT_ID`),
  ADD KEY `FK_PONTS_PONTS_CAP_CAPTEURS` (`CAPTEUR_ID`);

ALTER TABLE `RESERVATION`
  ADD PRIMARY KEY (`USER_ID`,`PONT_ID`,`BATEAU_ID`,`STATUS_ID`),
  ADD KEY `RESERVATION_FK` (`USER_ID`),
  ADD KEY `RESERVATION2_FK` (`PONT_ID`),
  ADD KEY `RESERVATION4_FK` (`BATEAU_ID`),
  ADD KEY `RESERVATION5_FK` (`STATUS_ID`),
  ADD KEY `FK_RESERVAT_RESERVATI_HORAIRES` (`HORAIRES_ID`);

ALTER TABLE `STATUS`
  ADD PRIMARY KEY (`STATUS_ID`);

ALTER TABLE `TYPE_USER`
  ADD PRIMARY KEY (`TYPE_USER_ID`);

ALTER TABLE `USERS`
  ADD PRIMARY KEY (`USER_ID`),
  ADD KEY `USER_ET_TYPE_USER_FK` (`TYPE_USER_ID`);

-- AUTO_INCREMENT pour les tables déchargées

ALTER TABLE `BATEAUX`
  MODIFY `BATEAU_ID` int(11) NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=9;

ALTER TABLE `CAPTEURS`
  MODIFY `CAPTEUR_ID` int(11) NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=5;

ALTER TABLE `DIRECTION_CRENEAU`
  MODIFY `DIRECTION_CRENEAU_ID` int(11) NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=4;

ALTER TABLE `HORAIRES_CRENEAUX`
  MODIFY `HORAIRES_ID` int(11) NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=50;

ALTER TABLE `PERIODE_CRENEAU`
  MODIFY `PERIODE_ID` int(11) NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=3;

ALTER TABLE `PONTS`
  MODIFY `PONT_ID` int(11) NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=3;

ALTER TABLE `RESERVATION`
  MODIFY `USER_ID` int(11) NOT NULL AUTO_INCREMENT;

ALTER TABLE `USERS`
  MODIFY `USER_ID` int(11) NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=13;

-- Contraintes pour les tables déchargées

ALTER TABLE `BATEAUX`
  ADD CONSTRAINT `FK_BATEAUX_ASSOCIATI_DIRECTIO` FOREIGN KEY (`DIRECTION_CRENEAU_ID`) REFERENCES `DIRECTION_CRENEAU` (`DIRECTION_CRENEAU_ID`),
  ADD CONSTRAINT `FK_BATEAUX_USER` FOREIGN KEY (`USER_ID`) REFERENCES `USERS` (`USER_ID`);

ALTER TABLE `HORAIRES_CRENEAUX`
  ADD CONSTRAINT `FK_HORAIRES_DIRECTION` FOREIGN KEY (`DIRECTION_CRENEAU_ID`) REFERENCES `DIRECTION_CRENEAU` (`DIRECTION_CRENEAU_ID`),
  ADD CONSTRAINT `FK_HORAIRES_PERIODE` FOREIGN KEY (`PERIODE_ID`) REFERENCES `PERIODE_CRENEAU` (`PERIODE_ID`);

ALTER TABLE `PONTS`
  ADD CONSTRAINT `FK_PONTS_PONTS_CAP_CAPTEURS` FOREIGN KEY (`CAPTEUR_ID`) REFERENCES `CAPTEURS` (`CAPTEUR_ID`);

ALTER TABLE `RESERVATION`
  ADD CONSTRAINT `FK_RESERVAT_RESERVATI_BATEAUX` FOREIGN KEY (`BATEAU_ID`) REFERENCES `BATEAUX` (`BATEAU_ID`),
  ADD CONSTRAINT `FK_RESERVAT_RESERVATI_HORAIRES` FOREIGN KEY (`HORAIRES_ID`) REFERENCES `HORAIRES_CRENEAUX` (`HORAIRES_ID`),
  ADD CONSTRAINT `FK_RESERVAT_RESERVATI_PONTS` FOREIGN KEY (`PONT_ID`) REFERENCES `PONTS` (`PONT_ID`),
  ADD CONSTRAINT `FK_RESERVAT_RESERVATI_STATUS` FOREIGN KEY (`STATUS_ID`) REFERENCES `STATUS` (`STATUS_ID`),
  ADD CONSTRAINT `FK_RESERVAT_RESERVATI_USERS` FOREIGN KEY (`USER_ID`) REFERENCES `USERS` (`USER_ID`);

ALTER TABLE `USERS`
  ADD CONSTRAINT `FK_USERS_USER_ET_T_TYPE_USE` FOREIGN KEY (`TYPE_USER_ID`) REFERENCES `TYPE_USER` (`TYPE_USER_ID`);